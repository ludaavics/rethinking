<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Chapter 8: Conditional Manatees &#8212; Statistical Rethinking</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="../_static/insipid.css?v=b2d00be7" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />

    <script src="../_static/documentation_options.js?v=63867087"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script defer src="../_static/insipid.js"></script>
    <script defer src="../_static/insipid-sidebar.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Chapter 7: Ulysse’s Compass" href="07_ulysse_s_copmpass.html" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
  </head><body>
    <script type="text/javascript">
        document.body.classList.add('js');
    </script>
    <input type="checkbox" id="sidebar-checkbox" style="display: none;">
    <label id="overlay" for="sidebar-checkbox"></label>
    <div class="sidebar-resize-handle"></div>
    <script type="text/javascript">
        try {
            let sidebar = localStorage.getItem('sphinx-sidebar');
            const sidebar_width = localStorage.getItem('sphinx-sidebar-width');
            if (sidebar_width) {
                document.documentElement.style.setProperty('--sidebar-width', sidebar_width);
            }
            // show sidebar on wide screen
            if (!sidebar && window.matchMedia('(min-width: 100rem)').matches) {
                sidebar = 'visible';
                // NB: We don't store the value in localStorage!
            }
            if (sidebar === 'visible') {
                document.getElementById('sidebar-checkbox').checked = true;
            }
        } catch(e) {
            console.info(e);
        }
    </script>
    <header id="topbar-placeholder">
      <div id="topbar">
        <div id="titlebar">
          <div class="buttons">
            <label for="sidebar-checkbox" id="sidebar-button" role="button" tabindex="0" aria-controls="sphinxsidebar" accesskey="M">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg>
            </label>
            <button id="search-button" type="button" title="Search" aria-label="Search" aria-expanded="false" aria-controls="search-form" accesskey="S">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
            </button>
          </div>
          <div class="title">
            <a class="parent" href="../index.html" accesskey="U">Statistical Rethinking</a>
            <a class="top" href="#">Chapter 8: Conditional Manatees</a>
          </div>
          <div class="buttons">
            <button id="fullscreen-button" type="button" aria-hidden="true">
              <span class="enable">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M212.686 315.314L120 408l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C10.697 480 0 469.255 0 456V344c0-21.382 25.803-32.09 40.922-16.971L72 360l92.686-92.686c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.249 6.248 6.249 16.378 0 22.627zm22.628-118.628L328 104l-32.922-31.029C279.958 57.851 290.666 32 312.048 32h112C437.303 32 448 42.745 448 56v112c0 21.382-25.803 32.09-40.922 16.971L376 152l-92.686 92.686c-6.248 6.248-16.379 6.248-22.627 0l-25.373-25.373c-6.249-6.248-6.249-16.378 0-22.627z"/></svg>
              </span>
              <span class="disable">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M4.686 427.314L104 328l-32.922-31.029C55.958 281.851 66.666 256 88.048 256h112C213.303 256 224 266.745 224 280v112c0 21.382-25.803 32.09-40.922 16.971L152 376l-99.314 99.314c-6.248 6.248-16.379 6.248-22.627 0L4.686 449.941c-6.248-6.248-6.248-16.379 0-22.627zM443.314 84.686L344 184l32.922 31.029c15.12 15.12 4.412 40.971-16.97 40.971h-112C234.697 256 224 245.255 224 232V120c0-21.382 25.803-32.09 40.922-16.971L296 136l99.314-99.314c6.248-6.248 16.379-6.248 22.627 0l25.373 25.373c6.248 6.248 6.248 16.379 0 22.627z"/></svg>
              </span>
            </button>
          </div>
        </div>
        <div id="searchbox" role="search">
          <form id="search-form" class="search" style="display: none" action="../search.html" method="get">
            <input type="search" name="q" placeholder="Search ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
            <button>Go</button>
          </form>
        </div>
      </div>
    </header>
    <nav>
      <a href="07_ulysse_s_copmpass.html" class="nav-icon previous" title="previous:&#13;Chapter 7: Ulysse’s Compass" aria-label="Previous topic" accesskey="P" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"/></svg>
      </a>
    </nav>

    <nav class="relbar">
      <a class="previous" href="07_ulysse_s_copmpass.html" aria-label="Previous topic" >
        <div class="icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"/></svg>
        </div>
        <div class="title">
          <span class="text">
            <span class="direction">previous</span>
            Chapter 7: Ulysse’s Compass
          </span>
        </div>
      </a>
    </nav>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
<section id="Chapter-8:-Conditional-Manatees">
<h1>Chapter 8: Conditional Manatees<a class="headerlink" href="#Chapter-8:-Conditional-Manatees" title="Link to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> jupyter_black

<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpyro</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">numpyro</span> <span class="kn">import</span> <span class="n">distributions</span> <span class="k">as</span> <span class="n">dist</span>
<span class="kn">from</span> <span class="nn">numpyro.infer</span> <span class="kn">import</span> <span class="n">SVI</span>
<span class="kn">from</span> <span class="nn">numpyro.infer.autoguide</span> <span class="kn">import</span> <span class="n">AutoLaplaceApproximation</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>

<span class="n">seed</span> <span class="o">=</span> <span class="mi">84735</span>
<span class="n">jrng</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">key</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>

<span class="n">optim</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">step_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Trace_ELBO</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<script type="application/javascript" id="jupyter_black">
(function() {
    if (window.IPython === undefined) {
        return
    }
    var msg = "WARNING: it looks like you might have loaded " +
        "jupyter_black in a non-lab notebook with " +
        "`is_lab=True`. Please double check, and if " +
        "loading with `%load_ext` please review the README!"
    console.log(msg)
    alert(msg)
})()
</script></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prune_return_sites</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[]):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">posterior_samples</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">depth</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="Code">
<h2>Code<a class="headerlink" href="#Code" title="Link to this heading">¶</a></h2>
<section id="Code-8.1">
<h3>Code 8.1<a class="headerlink" href="#Code-8.1" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/rugged.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<span class="n">_df</span><span class="p">[</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_df</span><span class="p">[</span><span class="s2">&quot;rgdppc_2000&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;rgdppc_2000&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>isocode</th>
      <th>isonum</th>
      <th>country</th>
      <th>rugged</th>
      <th>rugged_popw</th>
      <th>rugged_slope</th>
      <th>rugged_lsd</th>
      <th>rugged_pc</th>
      <th>land_area</th>
      <th>lat</th>
      <th>...</th>
      <th>slave_exports</th>
      <th>dist_slavemkt_atlantic</th>
      <th>dist_slavemkt_indian</th>
      <th>dist_slavemkt_saharan</th>
      <th>dist_slavemkt_redsea</th>
      <th>pop_1400</th>
      <th>european_descent</th>
      <th>log_gdp</th>
      <th>log_gdp_std</th>
      <th>rugged_std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>AGO</td>
      <td>24</td>
      <td>Angola</td>
      <td>0.858</td>
      <td>0.714</td>
      <td>2.274</td>
      <td>0.228</td>
      <td>4.906</td>
      <td>124670.0</td>
      <td>-12.299</td>
      <td>...</td>
      <td>3610000.0</td>
      <td>5.669</td>
      <td>6.981</td>
      <td>4.926</td>
      <td>3.872</td>
      <td>1223208.0</td>
      <td>2.000</td>
      <td>7.492610</td>
      <td>0.879712</td>
      <td>0.138342</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ALB</td>
      <td>8</td>
      <td>Albania</td>
      <td>3.427</td>
      <td>1.597</td>
      <td>10.451</td>
      <td>1.006</td>
      <td>62.133</td>
      <td>2740.0</td>
      <td>41.143</td>
      <td>...</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>200000.0</td>
      <td>100.000</td>
      <td>8.216929</td>
      <td>0.964755</td>
      <td>0.552564</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ARE</td>
      <td>784</td>
      <td>United Arab Emirates</td>
      <td>0.769</td>
      <td>0.316</td>
      <td>2.112</td>
      <td>0.191</td>
      <td>6.142</td>
      <td>8360.0</td>
      <td>23.913</td>
      <td>...</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>19200.0</td>
      <td>0.000</td>
      <td>9.933263</td>
      <td>1.166270</td>
      <td>0.123992</td>
    </tr>
    <tr>
      <th>8</th>
      <td>ARG</td>
      <td>32</td>
      <td>Argentina</td>
      <td>0.775</td>
      <td>0.220</td>
      <td>2.268</td>
      <td>0.226</td>
      <td>9.407</td>
      <td>273669.0</td>
      <td>-35.396</td>
      <td>...</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>276632.0</td>
      <td>89.889</td>
      <td>9.407031</td>
      <td>1.104485</td>
      <td>0.124960</td>
    </tr>
    <tr>
      <th>9</th>
      <td>ARM</td>
      <td>51</td>
      <td>Armenia</td>
      <td>2.688</td>
      <td>0.934</td>
      <td>8.178</td>
      <td>0.799</td>
      <td>50.556</td>
      <td>2820.0</td>
      <td>40.294</td>
      <td>...</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>105743.0</td>
      <td>0.500</td>
      <td>7.792343</td>
      <td>0.914904</td>
      <td>0.433409</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 54 columns</p>
</div></div>
</div>
</section>
<section id="Code-8.2">
<h3>Code 8.2<a class="headerlink" href="#Code-8.2" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rugged_bar</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">model_8_1</span><span class="p">(</span><span class="n">rugged</span><span class="p">,</span> <span class="n">log_gdp</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">rugged</span> <span class="o">-</span> <span class="n">rugged_bar</span><span class="p">))</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">log_gdp</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">log_gdp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log_gdp</span>
</pre></div>
</div>
</div>
</section>
<section id="Code-8.3">
<h3>Code 8.3<a class="headerlink" href="#Code-8.3" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ruggeds</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">prior_predictive_8_1</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model_8_1</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1_000</span><span class="p">)</span>
<span class="n">prior_predictive_samples_8_1</span> <span class="o">=</span> <span class="n">prior_predictive_8_1</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">ruggeds</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;ruggedness&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;log GDP&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">mu_prior</span> <span class="ow">in</span> <span class="n">prior_predictive_samples_8_1</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">][:</span><span class="mi">50</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ruggeds</span><span class="p">,</span> <span class="n">mu_prior</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.lines.Line2D at 0x13db3cce0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_08_conditional_manatees_8_1.png" src="../_images/notebooks_08_conditional_manatees_8_1.png" />
</div>
</div>
</section>
<section id="Code-8.4">
<h3>Code 8.4<a class="headerlink" href="#Code-8.4" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">prior_predictive_samples_8_1</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.6</span>
<span class="p">)</span> <span class="o">/</span> <span class="n">prior_predictive_samples_8_1</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Array(0.555, dtype=float32)
</pre></div></div>
</div>
</section>
<section id="Code-8.5">
<h3>Code 8.5<a class="headerlink" href="#Code-8.5" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_8_1</span><span class="p">(</span><span class="n">rugged</span><span class="p">,</span> <span class="n">log_gdp</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">rugged</span> <span class="o">-</span> <span class="n">rugged_bar</span><span class="p">))</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">log_gdp</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">log_gdp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log_gdp</span>


<span class="n">guide_8_1</span> <span class="o">=</span> <span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">model_8_1</span><span class="p">)</span>
<span class="n">svi_8_1</span> <span class="o">=</span> <span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_1</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide_8_1</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">posterior_samples_8_1</span> <span class="o">=</span> <span class="n">guide_8_1</span><span class="o">.</span><span class="n">sample_posterior</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">svi_8_1</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
    <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,),</span>
<span class="p">)</span>
<span class="n">log_likelihood_8_1</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_1</span><span class="p">,</span>
    <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8_1</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">idata_8_1</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="n">posterior</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">posterior_samples_8_1</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">log_likelihood</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">log_likelihood_8_1</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██| 2000/2000 [00:01&lt;00:00, 1601.31it/s, init loss: 1197.5797, avg. loss [1901-2000]: -96.7952]
</pre></div></div>
</div>
</section>
<section id="Code-8.6">
<h3>Code 8.6<a class="headerlink" href="#Code-8.6" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span>
    <span class="n">prune_return_sites</span><span class="p">(</span><span class="n">posterior_samples_8_1</span><span class="p">),</span>
    <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">,</span>
    <span class="n">group_by_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                mean       std    median      5.5%     94.5%     n_eff     r_hat
         a      1.00      0.01      1.00      0.98      1.02    935.40      1.00
         b      0.00      0.05      0.00     -0.08      0.09    921.03      1.00
     sigma      0.14      0.01      0.14      0.13      0.15   1139.10      1.00

</pre></div></div>
</div>
</section>
<section id="Code-8.7">
<h3>Code 8.7<a class="headerlink" href="#Code-8.7" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make variable to index Africa (0) or not (1)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cont_africa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Code-8.8">
<h3>Code 8.8<a class="headerlink" href="#Code-8.8" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_8_2</span><span class="p">(</span><span class="n">rugged</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">log_gdp</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">plate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;continent&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">rugged</span> <span class="o">-</span> <span class="n">rugged_bar</span><span class="p">))</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">log_gdp</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">log_gdp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log_gdp</span>


<span class="n">guide_8_2</span> <span class="o">=</span> <span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">model_8_2</span><span class="p">)</span>
<span class="n">svi_8_2</span> <span class="o">=</span> <span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_2</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide_8_2</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">posterior_samples_8_2</span> <span class="o">=</span> <span class="n">guide_8_2</span><span class="o">.</span><span class="n">sample_posterior</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">svi_8_2</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
    <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,),</span>
<span class="p">)</span>
<span class="n">log_likelihood_8_2</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_2</span><span class="p">,</span>
    <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8_2</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">idata_8_2</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="n">posterior</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">posterior_samples_8_2</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">log_likelihood</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">log_likelihood_8_2</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██| 2000/2000 [00:01&lt;00:00, 1679.05it/s, init loss: 316.5610, avg. loss [1901-2000]: -130.1099]
</pre></div></div>
</div>
</section>
<section id="Code-8.9">
<h3>Code 8.9<a class="headerlink" href="#Code-8.9" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compare_8_1</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;model_8_1&quot;</span><span class="p">:</span> <span class="n">idata_8_1</span><span class="p">,</span> <span class="s2">&quot;model_8_2&quot;</span><span class="p">:</span> <span class="n">idata_8_2</span><span class="p">},</span>
    <span class="n">ic</span><span class="o">=</span><span class="s2">&quot;loo&quot;</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;deviance&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_compare</span><span class="p">(</span><span class="n">compare_8_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: title={&#39;center&#39;: &#39;Model comparison\nlower is better&#39;}, xlabel=&#39;elpd_loo (deviance)&#39;, ylabel=&#39;ranked models&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_08_conditional_manatees_20_1.png" src="../_images/notebooks_08_conditional_manatees_20_1.png" />
</div>
</div>
</section>
<section id="Code-8.10">
<h3>Code 8.10<a class="headerlink" href="#Code-8.10" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span>
    <span class="n">prune_return_sites</span><span class="p">(</span><span class="n">posterior_samples_8_2</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]),</span>
    <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">,</span>
    <span class="n">group_by_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                mean       std    median      5.5%     94.5%     n_eff     r_hat
      a[0]      0.88      0.02      0.88      0.86      0.91    848.14      1.00
      a[1]      1.05      0.01      1.05      1.03      1.06    925.96      1.00
         b     -0.05      0.05     -0.05     -0.12      0.03   1022.04      1.00
     sigma      0.11      0.01      0.11      0.10      0.12   1019.41      1.00

</pre></div></div>
</div>
</section>
<section id="Code-8.11">
<h3>Code 8.11<a class="headerlink" href="#Code-8.11" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff_a1_s2</span> <span class="o">=</span> <span class="n">posterior_samples_8_2</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">posterior_samples_8_2</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">hpdi</span><span class="p">(</span><span class="n">diff_a1_s2</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([-0.19450629, -0.13572162], dtype=float32)
</pre></div></div>
</div>
</section>
<section id="Code-8.12">
<h3>Code 8.12<a class="headerlink" href="#Code-8.12" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ruggeds</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">posterior_predictive_8_2</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_2</span><span class="p">,</span> <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8_2</span>
<span class="p">)</span>
<span class="n">posterior_predictive_africa_samples_8_2</span> <span class="o">=</span> <span class="n">posterior_predictive_8_2</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">ruggeds</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">mu_mean_africa_8_2</span> <span class="o">=</span> <span class="n">posterior_predictive_africa_samples_8_2</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mu_hpdi_africa_8_2</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">hpdi</span><span class="p">(</span>
    <span class="n">posterior_predictive_africa_samples_8_2</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">posterior_predictive_not_africa_samples_8_2</span> <span class="o">=</span> <span class="n">posterior_predictive_8_2</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">ruggeds</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">mu_mean_not_africa_8_2</span> <span class="o">=</span> <span class="n">posterior_predictive_not_africa_samples_8_2</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mu_hpdi_not_africa_8_2</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">hpdi</span><span class="p">(</span>
    <span class="n">posterior_predictive_not_africa_samples_8_2</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;ruggedness&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;log GDP&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;rugged_std&quot;</span><span class="p">],</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;log_gdp_std&quot;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span>
    <span class="n">facecolors</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ruggeds</span><span class="p">,</span> <span class="n">mu_mean_africa_8_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">ruggeds</span><span class="p">,</span>
    <span class="n">mu_hpdi_africa_8_2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">mu_hpdi_africa_8_2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;rugged_std&quot;</span><span class="p">],</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;log_gdp_std&quot;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">facecolors</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ruggeds</span><span class="p">,</span> <span class="n">mu_mean_not_africa_8_2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">ruggeds</span><span class="p">,</span>
    <span class="n">mu_hpdi_not_africa_8_2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">mu_hpdi_not_africa_8_2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.PolyCollection at 0x13f96a0f0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_08_conditional_manatees_27_1.png" src="../_images/notebooks_08_conditional_manatees_27_1.png" />
</div>
</div>
</section>
<section id="Code-8.13">
<h3>Code 8.13<a class="headerlink" href="#Code-8.13" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_8_3</span><span class="p">(</span><span class="n">rugged</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">log_gdp</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">plate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;continent&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">rugged</span> <span class="o">-</span> <span class="n">rugged_bar</span><span class="p">))</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">log_gdp</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">log_gdp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log_gdp</span>


<span class="n">guide_8_3</span> <span class="o">=</span> <span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">model_8_3</span><span class="p">)</span>
<span class="n">svi_8_3</span> <span class="o">=</span> <span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_3</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide_8_3</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">posterior_samples_8_3</span> <span class="o">=</span> <span class="n">guide_8_3</span><span class="o">.</span><span class="n">sample_posterior</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">svi_8_3</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
    <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,),</span>
<span class="p">)</span>
<span class="n">log_likelihood_8_3</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_3</span><span class="p">,</span>
    <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8_3</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">idata_8_3</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="n">posterior</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">posterior_samples_8_3</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">log_likelihood</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">log_likelihood_8_3</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██| 2000/2000 [00:01&lt;00:00, 1196.68it/s, init loss: 319.7917, avg. loss [1901-2000]: -134.7925]
</pre></div></div>
</div>
</section>
<section id="Code-8.14">
<h3>Code 8.14<a class="headerlink" href="#Code-8.14" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span>
    <span class="n">prune_return_sites</span><span class="p">(</span><span class="n">posterior_samples_8_3</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]),</span>
    <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">,</span>
    <span class="n">group_by_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                mean       std    median      5.5%     94.5%     n_eff     r_hat
      a[0]      0.89      0.02      0.89      0.86      0.91   1035.36      1.00
      a[1]      1.05      0.01      1.05      1.03      1.07   1035.53      1.00
      b[0]      0.13      0.07      0.13      0.01      0.25    823.34      1.00
      b[1]     -0.14      0.06     -0.14     -0.24     -0.06    916.91      1.00
     sigma      0.11      0.01      0.11      0.10      0.12   1017.70      1.00

</pre></div></div>
</div>
</section>
<section id="Code-8.15">
<h3>Code 8.15<a class="headerlink" href="#Code-8.15" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compare_8_2</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;model_8_1&quot;</span><span class="p">:</span> <span class="n">idata_8_1</span><span class="p">,</span>
        <span class="s2">&quot;model_8_2&quot;</span><span class="p">:</span> <span class="n">idata_8_2</span><span class="p">,</span>
        <span class="s2">&quot;model_8_3&quot;</span><span class="p">:</span> <span class="n">idata_8_3</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">ic</span><span class="o">=</span><span class="s2">&quot;loo&quot;</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;deviance&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">compare_8_2</span><span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_compare</span><span class="p">(</span><span class="n">compare_8_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rank</th>
      <th>elpd_loo</th>
      <th>p_loo</th>
      <th>elpd_diff</th>
      <th>weight</th>
      <th>se</th>
      <th>dse</th>
      <th>warning</th>
      <th>scale</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>model_8_3</th>
      <td>0</td>
      <td>-258.210677</td>
      <td>5.605261</td>
      <td>0.000000</td>
      <td>8.154544e-01</td>
      <td>15.236033</td>
      <td>0.000000</td>
      <td>False</td>
      <td>deviance</td>
    </tr>
    <tr>
      <th>model_8_2</th>
      <td>1</td>
      <td>-251.778467</td>
      <td>4.460672</td>
      <td>6.432210</td>
      <td>1.845456e-01</td>
      <td>15.273825</td>
      <td>6.702674</td>
      <td>False</td>
      <td>deviance</td>
    </tr>
    <tr>
      <th>model_8_1</th>
      <td>2</td>
      <td>-188.798162</td>
      <td>2.654495</td>
      <td>69.412516</td>
      <td>1.110223e-16</td>
      <td>13.205733</td>
      <td>15.446492</td>
      <td>False</td>
      <td>deviance</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: title={&#39;center&#39;: &#39;Model comparison\nlower is better&#39;}, xlabel=&#39;elpd_loo (deviance)&#39;, ylabel=&#39;ranked models&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_08_conditional_manatees_33_2.png" src="../_images/notebooks_08_conditional_manatees_33_2.png" />
</div>
</div>
</section>
<section id="Code-8.16">
<h3>Code 8.16<a class="headerlink" href="#Code-8.16" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">az</span><span class="o">.</span><span class="n">loo</span><span class="p">(</span><span class="n">idata_8_3</span><span class="p">,</span> <span class="n">pointwise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;deviance&quot;</span><span class="p">)[</span><span class="s2">&quot;pareto_k&quot;</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;isocode&quot;</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pareto_k&quot;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;pareto_k&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pareto_k</th>
    </tr>
    <tr>
      <th>isocode</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SYC</th>
      <td>0.646057</td>
    </tr>
    <tr>
      <th>LSO</th>
      <td>0.560495</td>
    </tr>
    <tr>
      <th>CHE</th>
      <td>0.426385</td>
    </tr>
    <tr>
      <th>SWZ</th>
      <td>0.329535</td>
    </tr>
    <tr>
      <th>TJK</th>
      <td>0.308890</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>MKD</th>
      <td>-0.188443</td>
    </tr>
    <tr>
      <th>SDN</th>
      <td>-0.208218</td>
    </tr>
    <tr>
      <th>GRD</th>
      <td>-0.215233</td>
    </tr>
    <tr>
      <th>AGO</th>
      <td>-0.232177</td>
    </tr>
    <tr>
      <th>TUR</th>
      <td>-0.285563</td>
    </tr>
  </tbody>
</table>
<p>170 rows × 1 columns</p>
</div></div>
</div>
</section>
<section id="Code-8.17">
<h3>Code 8.17<a class="headerlink" href="#Code-8.17" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ruggeds</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">posterior_predictive_8_3</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_3</span><span class="p">,</span> <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8_3</span>
<span class="p">)</span>
<span class="n">posterior_predictive_africa_samples_8_3</span> <span class="o">=</span> <span class="n">posterior_predictive_8_3</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">ruggeds</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">mu_mean_africa_8_3</span> <span class="o">=</span> <span class="n">posterior_predictive_africa_samples_8_3</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mu_hpdi_africa_8_3</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">hpdi</span><span class="p">(</span>
    <span class="n">posterior_predictive_africa_samples_8_3</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">posterior_predictive_not_africa_samples_8_3</span> <span class="o">=</span> <span class="n">posterior_predictive_8_3</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">ruggeds</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">mu_mean_not_africa_8_3</span> <span class="o">=</span> <span class="n">posterior_predictive_not_africa_samples_8_3</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mu_hpdi_not_africa_8_3</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">hpdi</span><span class="p">(</span>
    <span class="n">posterior_predictive_not_africa_samples_8_3</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;ruggedness&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;log GDP&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;rugged_std&quot;</span><span class="p">],</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;log_gdp_std&quot;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span>
    <span class="n">facecolors</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ruggeds</span><span class="p">,</span> <span class="n">mu_mean_africa_8_3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">ruggeds</span><span class="p">,</span>
    <span class="n">mu_hpdi_africa_8_3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">mu_hpdi_africa_8_3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;rugged_std&quot;</span><span class="p">],</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;log_gdp_std&quot;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">facecolors</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ruggeds</span><span class="p">,</span> <span class="n">mu_mean_not_africa_8_3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">ruggeds</span><span class="p">,</span>
    <span class="n">mu_hpdi_not_africa_8_3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">mu_hpdi_not_africa_8_3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.PolyCollection at 0x1400aa660&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_08_conditional_manatees_38_1.png" src="../_images/notebooks_08_conditional_manatees_38_1.png" />
</div>
</div>
</section>
<section id="Code-8.18">
<h3>Code 8.18<a class="headerlink" href="#Code-8.18" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delta</span> <span class="o">=</span> <span class="n">mu_mean_africa_8_3</span> <span class="o">-</span> <span class="n">mu_mean_not_africa_8_3</span>
<span class="n">delta</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Array([-0.25105107, -0.24054533, -0.23003942, -0.21953315, -0.20902741,
       -0.19852114, -0.1880151 , -0.17750901, -0.16700304, -0.15649724,
       -0.14599109, -0.13548487, -0.1249789 , -0.11447299, -0.10396683,
       -0.09346092, -0.0829547 , -0.07244873, -0.06194282, -0.05143672,
       -0.04093057, -0.03042477, -0.01991856, -0.00941259,  0.00109327,
        0.01159948,  0.02210546,  0.03261167,  0.04311764,  0.0536235 ],      dtype=float32)
</pre></div></div>
</div>
</section>
<section id="Code-8.19">
<h3>Code 8.19<a class="headerlink" href="#Code-8.19" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/tulips.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bed</th>
      <th>water</th>
      <th>shade</th>
      <th>blooms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a</td>
      <td>1</td>
      <td>1</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a</td>
      <td>1</td>
      <td>2</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a</td>
      <td>1</td>
      <td>3</td>
      <td>111.04</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a</td>
      <td>2</td>
      <td>1</td>
      <td>183.47</td>
    </tr>
    <tr>
      <th>4</th>
      <td>a</td>
      <td>2</td>
      <td>2</td>
      <td>59.16</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Code-8.20">
<h3>Code 8.20<a class="headerlink" href="#Code-8.20" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;water_cent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;water&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade_cent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</section>
<section id="Code-8.21">
<h3>Code 8.21<a class="headerlink" href="#Code-8.21" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,))</span>
<span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Array(0.6189, dtype=float32)
</pre></div></div>
</div>
</section>
<section id="Code-8.22">
<h3>Code 8.22<a class="headerlink" href="#Code-8.22" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,))</span>
<span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Array(0.0448, dtype=float32)
</pre></div></div>
</div>
</section>
<section id="Code-8.23">
<h3>Code 8.23<a class="headerlink" href="#Code-8.23" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_8_4</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">shade</span><span class="p">,</span> <span class="n">blooms</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">b_water</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b_water&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">b_shade</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b_shade&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b_water</span> <span class="o">*</span> <span class="n">water</span> <span class="o">+</span> <span class="n">b_shade</span> <span class="o">*</span> <span class="n">shade</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigam&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">blooms</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;blooms&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">blooms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">blooms</span>


<span class="n">guide_8_4</span> <span class="o">=</span> <span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">model_8_4</span><span class="p">)</span>
<span class="n">svi_8_4</span> <span class="o">=</span> <span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_4</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide_8_4</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">water</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;water_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">shade</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">blooms</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">posterior_samples_8_4</span> <span class="o">=</span> <span class="n">guide_8_4</span><span class="o">.</span><span class="n">sample_posterior</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">svi_8_4</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
    <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,),</span>
<span class="p">)</span>
<span class="n">posterior_predictive_8_4</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_4</span><span class="p">,</span> <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8_4</span>
<span class="p">)</span>
<span class="n">log_likelihood_8_4</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_4</span><span class="p">,</span>
    <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8_4</span><span class="p">,</span>
    <span class="n">water</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;water_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">shade</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">blooms</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">idata_8_4</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="n">posterior</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">posterior_samples_8_4</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">log_likelihood</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">log_likelihood_8_4</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███| 2000/2000 [00:01&lt;00:00, 1615.38it/s, init loss: 618.7037, avg. loss [1901-2000]: -10.2150]
</pre></div></div>
</div>
</section>
<section id="Code-8.24">
<h3>Code 8.24<a class="headerlink" href="#Code-8.24" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_8_5</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">shade</span><span class="p">,</span> <span class="n">blooms</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">b_water</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b_water&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">b_shade</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b_shade&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">b_water_shade</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b_water_shade&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span>
        <span class="s2">&quot;mu&quot;</span><span class="p">,</span>
        <span class="n">a</span> <span class="o">+</span> <span class="n">b_water</span> <span class="o">*</span> <span class="n">water</span> <span class="o">+</span> <span class="n">b_shade</span> <span class="o">*</span> <span class="n">shade</span> <span class="o">+</span> <span class="n">b_water_shade</span> <span class="o">*</span> <span class="n">water</span> <span class="o">*</span> <span class="n">shade</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigam&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">blooms</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;blooms&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">blooms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">blooms</span>


<span class="n">guide_8_5</span> <span class="o">=</span> <span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">model_8_5</span><span class="p">)</span>
<span class="n">svi_8_5</span> <span class="o">=</span> <span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_5</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide_8_5</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">water</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;water_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">shade</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">blooms</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">posterior_samples_8_5</span> <span class="o">=</span> <span class="n">guide_8_5</span><span class="o">.</span><span class="n">sample_posterior</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">svi_8_5</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
    <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,),</span>
<span class="p">)</span>
<span class="n">posterior_predictive_8_5</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_5</span><span class="p">,</span> <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8_5</span>
<span class="p">)</span>
<span class="n">log_likelihood_8_5</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_5</span><span class="p">,</span>
    <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8_5</span><span class="p">,</span>
    <span class="n">water</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;water_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">shade</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">blooms</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">idata_8_5</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="n">posterior</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">posterior_samples_8_5</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">log_likelihood</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">log_likelihood_8_5</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███| 2000/2000 [00:01&lt;00:00, 1154.53it/s, init loss: 136.6452, avg. loss [1901-2000]: -16.7085]
</pre></div></div>
</div>
</section>
<section id="Code-8.25">
<h3>Code 8.25<a class="headerlink" href="#Code-8.25" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">waters</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">_shade</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade_cent&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">_shade</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">_posterior_predictive</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;model 8.4&quot;</span><span class="p">,</span> <span class="s2">&quot;model 8.5&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="n">posterior_predictive_8_4</span><span class="p">,</span> <span class="n">posterior_predictive_8_5</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
            <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
            <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;blooms&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> | shade=</span><span class="si">{</span><span class="n">_shade</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">_df</span><span class="p">[</span><span class="s2">&quot;water_cent&quot;</span><span class="p">],</span> <span class="n">_df</span><span class="p">[</span><span class="s2">&quot;blooms_std&quot;</span><span class="p">])</span>
        <span class="n">_posterior_predictive_samples</span> <span class="o">=</span> <span class="n">_posterior_predictive</span><span class="p">(</span>
            <span class="n">jrng</span><span class="p">,</span> <span class="n">water</span><span class="o">=</span><span class="n">waters</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="n">_shade</span><span class="p">,</span> <span class="n">blooms</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">_posterior_predictive_sample</span> <span class="ow">in</span> <span class="n">_posterior_predictive_samples</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">][:</span><span class="mi">20</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">waters</span><span class="p">,</span> <span class="n">_posterior_predictive_sample</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_08_conditional_manatees_54_0.png" src="../_images/notebooks_08_conditional_manatees_54_0.png" />
</div>
</div>
</section>
<section id="Code-8.26">
<h3>Code 8.26<a class="headerlink" href="#Code-8.26" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prior_predictive_samples_8_4</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1_000</span>
<span class="p">)(</span><span class="n">jrng</span><span class="p">,</span> <span class="n">water</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">blooms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">prior_predictive_samples_8_5</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">Predictive</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8_5</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1_000</span>
<span class="p">)(</span><span class="n">jrng</span><span class="p">,</span> <span class="n">water</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">blooms</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Easy">
<h2>Easy<a class="headerlink" href="#Easy" title="Link to this heading">¶</a></h2>
<section id="8E1">
<h3>8E1<a class="headerlink" href="#8E1" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>temperature</p></li>
<li><p>wealth</p></li>
<li><p>battery</p></li>
</ol>
</section>
<section id="8E2">
<h3>8E2<a class="headerlink" href="#8E2" title="Link to this heading">¶</a></h3>
<p>Only (1): interaction between the heat and the amount of water</p>
</section>
<section id="8E3">
<h3>8E3<a class="headerlink" href="#8E3" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\(C = \alpha + \Beta_H H + \Beta_W W + \Beta_{HW} HW\)</span> (caramelization vs heat and water)</p></li>
<li><p><span class="math notranslate nohighlight">\(S = \alpha + \Beta_C C + \Beta_F F\)</span> (speed vs cylinders and fuel injector)</p></li>
<li><p><span class="math notranslate nohighlight">\(C = \alpha + \Beta_P P + \Beta_F F\)</span> (conservativsm vs parents’ and friends’ conservativsm)</p></li>
<li><p><span class="math notranslate nohighlight">\(I = \alpha + \Beta_S S + \Beta_A A\)</span> (intelligence vs social level and number of appendages)</p></li>
</ol>
</section>
</section>
<section id="Medium">
<h2>Medium<a class="headerlink" href="#Medium" title="Link to this heading">¶</a></h2>
<section id="8M1">
<h3>8M1<a class="headerlink" href="#8M1" title="Link to this heading">¶</a></h3>
<p>No amount of water or light can make a tulip bloom if the temperature is hot.</p>
</section>
<section id="8M2">
<h3>8M2<a class="headerlink" href="#8M2" title="Link to this heading">¶</a></h3>
<p>$ B = (<span class="math">\alpha `+ :nbsphinx-math:</span>Beta`<em>W W + :nbsphinx-math:`Beta`S S + :nbsphinx-math:`Beta`{WS} W :nbsphinx-math:`cdot `S) :nbsphinx-math:`mathbb{1}`</em>{C}$</p>
</section>
<section id="8M3">
<h3>8M3<a class="headerlink" href="#8M3" title="Link to this heading">¶</a></h3>
<p>Not an interaction</p>
<p>$ R = <span class="math">\alpha `+ :nbsphinx-math:</span>Beta`_{preys} P + <span class="math">\Beta</span>_W W$</p>
</section>
</section>
<section id="Hard">
<h2>Hard<a class="headerlink" href="#Hard" title="Link to this heading">¶</a></h2>
<section id="8H1">
<h3>8H1<a class="headerlink" href="#8H1" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/tulips.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;water_cent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;water&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade_cent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span>
<span class="n">bed_labels</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bed&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;bed_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bed_labels</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bed&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bed</th>
      <th>water</th>
      <th>shade</th>
      <th>blooms</th>
      <th>blooms_std</th>
      <th>water_cent</th>
      <th>shade_cent</th>
      <th>bed_idx</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a</td>
      <td>1</td>
      <td>1</td>
      <td>0.00</td>
      <td>0.000000</td>
      <td>-1</td>
      <td>-1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a</td>
      <td>1</td>
      <td>2</td>
      <td>0.00</td>
      <td>0.000000</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>a</td>
      <td>1</td>
      <td>3</td>
      <td>111.04</td>
      <td>0.307029</td>
      <td>-1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a</td>
      <td>2</td>
      <td>1</td>
      <td>183.47</td>
      <td>0.507300</td>
      <td>0</td>
      <td>-1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>a</td>
      <td>2</td>
      <td>2</td>
      <td>59.16</td>
      <td>0.163579</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_8h1</span><span class="p">(</span><span class="n">bed</span><span class="p">,</span> <span class="n">water</span><span class="p">,</span> <span class="n">shade</span><span class="p">,</span> <span class="n">blooms</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">plate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;bed&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bed_labels</span><span class="o">.</span><span class="n">classes_</span><span class="p">)):</span>
        <span class="n">b_bed</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b_bed&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">b_water</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b_water&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">b_shade</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b_shade&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
    <span class="n">b_water_shade</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b_water_shade&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span>
        <span class="s2">&quot;mu&quot;</span><span class="p">,</span>
        <span class="n">b_bed</span><span class="p">[</span><span class="n">bed</span><span class="p">]</span> <span class="o">+</span> <span class="n">b_water</span> <span class="o">*</span> <span class="n">water</span> <span class="o">+</span> <span class="n">b_shade</span> <span class="o">*</span> <span class="n">shade</span> <span class="o">+</span> <span class="n">b_water_shade</span> <span class="o">*</span> <span class="n">water</span> <span class="o">*</span> <span class="n">shade</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">blooms</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;blooms&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">blooms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">blooms</span>


<span class="n">guide_8h1</span> <span class="o">=</span> <span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">model_8h1</span><span class="p">)</span>
<span class="n">svi_8h1</span> <span class="o">=</span> <span class="n">SVI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model_8h1</span><span class="p">,</span> <span class="n">guide</span><span class="o">=</span><span class="n">guide_8h1</span><span class="p">,</span> <span class="n">optim</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">num_steps</span><span class="o">=</span><span class="mi">2_500</span><span class="p">,</span>
    <span class="n">bed</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bed_idx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">water</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;water_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">shade</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">blooms</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">posterior_samples_8h1</span> <span class="o">=</span> <span class="n">guide_8h1</span><span class="o">.</span><span class="n">sample_posterior</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">svi_8h1</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,)</span>
<span class="p">)</span>
<span class="n">log_likelihood_8h1</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8h1</span><span class="p">,</span>
    <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8h1</span><span class="p">,</span>
    <span class="n">bed</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bed_idx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">water</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;water_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">shade</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;shade_cent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">blooms</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;blooms_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">idata_8h1</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="n">posterior</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">posterior_samples_8h1</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">log_likelihood</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">log_likelihood_8h1</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<span class="p">)</span>
<span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span>
    <span class="n">prune_return_sites</span><span class="p">(</span><span class="n">posterior_samples_8h1</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]),</span>
    <span class="n">prob</span><span class="o">=</span><span class="mf">0.89</span><span class="p">,</span>
    <span class="n">group_by_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███| 2500/2500 [00:01&lt;00:00, 1701.15it/s, init loss: 129.5476, avg. loss [2376-2500]: -18.4594]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                     mean       std    median      5.5%     94.5%     n_eff     r_hat
       b_bed[0]      0.26      0.04      0.26      0.21      0.32   1003.20      1.00
       b_bed[1]      0.38      0.04      0.38      0.33      0.44    976.62      1.00
       b_bed[2]      0.40      0.04      0.40      0.34      0.46    994.15      1.00
        b_shade     -0.11      0.03     -0.11     -0.16     -0.07    984.75      1.00
        b_water      0.21      0.03      0.21      0.17      0.25    956.69      1.00
  b_water_shade     -0.15      0.03     -0.15     -0.20     -0.10   1021.23      1.00
          sigma      0.11      0.02      0.11      0.09      0.14   1047.37      1.00

</pre></div></div>
</div>
</section>
<section id="8H2">
<h3>8H2<a class="headerlink" href="#8H2" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comparison_8h2</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">compare</span><span class="p">({</span><span class="s2">&quot;model_8_5&quot;</span><span class="p">:</span> <span class="n">idata_8_5</span><span class="p">,</span> <span class="s2">&quot;model_8h1&quot;</span><span class="p">:</span> <span class="n">idata_8h1</span><span class="p">},</span> <span class="n">ic</span><span class="o">=</span><span class="s2">&quot;loo&quot;</span><span class="p">)</span>
<span class="n">az</span><span class="o">.</span><span class="n">plot_compare</span><span class="p">(</span><span class="n">comparison_8h2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/ltiako/.pyenv/versions/3.12.3/envs/rethinking/lib/python3.12/site-packages/arviz/stats/stats.py:789: UserWarning: Estimated shape parameter of Pareto distribution is greater than 0.7 for one or more samples. You should consider using a more robust model, this is because importance sampling is less likely to work well if the marginal posterior and LOO posterior are very different. This is more likely to happen with a non-robust model and highly influential observations.
  warnings.warn(
/Users/ltiako/.pyenv/versions/3.12.3/envs/rethinking/lib/python3.12/site-packages/arviz/stats/stats.py:789: UserWarning: Estimated shape parameter of Pareto distribution is greater than 0.7 for one or more samples. You should consider using a more robust model, this is because importance sampling is less likely to work well if the marginal posterior and LOO posterior are very different. This is more likely to happen with a non-robust model and highly influential observations.
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: title={&#39;center&#39;: &#39;Model comparison\nhigher is better&#39;}, xlabel=&#39;elpd_loo (log)&#39;, ylabel=&#39;ranked models&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_08_conditional_manatees_64_2.png" src="../_images/notebooks_08_conditional_manatees_64_2.png" />
</div>
</div>
<p>No discernible difference between the two models.</p>
</section>
<section id="8H3">
<h3>8H3<a class="headerlink" href="#8H3" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/rugged.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<span class="n">_df</span><span class="p">[</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_df</span><span class="p">[</span><span class="s2">&quot;rgdppc_2000&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;rgdppc_2000&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cont_africa&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>isocode</th>
      <th>isonum</th>
      <th>country</th>
      <th>rugged</th>
      <th>rugged_popw</th>
      <th>rugged_slope</th>
      <th>rugged_lsd</th>
      <th>rugged_pc</th>
      <th>land_area</th>
      <th>lat</th>
      <th>...</th>
      <th>dist_slavemkt_atlantic</th>
      <th>dist_slavemkt_indian</th>
      <th>dist_slavemkt_saharan</th>
      <th>dist_slavemkt_redsea</th>
      <th>pop_1400</th>
      <th>european_descent</th>
      <th>log_gdp</th>
      <th>log_gdp_std</th>
      <th>rugged_std</th>
      <th>cid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>AGO</td>
      <td>24</td>
      <td>Angola</td>
      <td>0.858</td>
      <td>0.714</td>
      <td>2.274</td>
      <td>0.228</td>
      <td>4.906</td>
      <td>124670.0</td>
      <td>-12.299</td>
      <td>...</td>
      <td>5.669</td>
      <td>6.981</td>
      <td>4.926</td>
      <td>3.872</td>
      <td>1223208.0</td>
      <td>2.000</td>
      <td>7.492610</td>
      <td>0.879712</td>
      <td>0.138342</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ALB</td>
      <td>8</td>
      <td>Albania</td>
      <td>3.427</td>
      <td>1.597</td>
      <td>10.451</td>
      <td>1.006</td>
      <td>62.133</td>
      <td>2740.0</td>
      <td>41.143</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>200000.0</td>
      <td>100.000</td>
      <td>8.216929</td>
      <td>0.964755</td>
      <td>0.552564</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ARE</td>
      <td>784</td>
      <td>United Arab Emirates</td>
      <td>0.769</td>
      <td>0.316</td>
      <td>2.112</td>
      <td>0.191</td>
      <td>6.142</td>
      <td>8360.0</td>
      <td>23.913</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>19200.0</td>
      <td>0.000</td>
      <td>9.933263</td>
      <td>1.166270</td>
      <td>0.123992</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>ARG</td>
      <td>32</td>
      <td>Argentina</td>
      <td>0.775</td>
      <td>0.220</td>
      <td>2.268</td>
      <td>0.226</td>
      <td>9.407</td>
      <td>273669.0</td>
      <td>-35.396</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>276632.0</td>
      <td>89.889</td>
      <td>9.407031</td>
      <td>1.104485</td>
      <td>0.124960</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>ARM</td>
      <td>51</td>
      <td>Armenia</td>
      <td>2.688</td>
      <td>0.934</td>
      <td>8.178</td>
      <td>0.799</td>
      <td>50.556</td>
      <td>2820.0</td>
      <td>40.294</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>105743.0</td>
      <td>0.500</td>
      <td>7.792343</td>
      <td>0.914904</td>
      <td>0.433409</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 55 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span>
    <span class="n">prune_return_sites</span><span class="p">(</span><span class="n">posterior_samples_8_3</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]),</span>
    <span class="n">group_by_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">az</span><span class="o">.</span><span class="n">loo</span><span class="p">(</span><span class="n">idata_8_3</span><span class="p">,</span> <span class="n">pointwise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;deviance&quot;</span><span class="p">)[</span><span class="s2">&quot;pareto_k&quot;</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;isocode&quot;</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pareto_k&quot;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;pareto_k&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                mean       std    median      5.0%     95.0%     n_eff     r_hat
      a[0]      0.89      0.02      0.89      0.86      0.91   1035.36      1.00
      a[1]      1.05      0.01      1.05      1.03      1.07   1035.53      1.00
      b[0]      0.13      0.07      0.13      0.01      0.25    823.34      1.00
      b[1]     -0.14      0.06     -0.14     -0.24     -0.06    916.91      1.00
     sigma      0.11      0.01      0.11      0.10      0.12   1017.70      1.00

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pareto_k</th>
    </tr>
    <tr>
      <th>isocode</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SYC</th>
      <td>0.646057</td>
    </tr>
    <tr>
      <th>LSO</th>
      <td>0.560495</td>
    </tr>
    <tr>
      <th>CHE</th>
      <td>0.426385</td>
    </tr>
    <tr>
      <th>SWZ</th>
      <td>0.329535</td>
    </tr>
    <tr>
      <th>TJK</th>
      <td>0.308890</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>MKD</th>
      <td>-0.188443</td>
    </tr>
    <tr>
      <th>SDN</th>
      <td>-0.208218</td>
    </tr>
    <tr>
      <th>GRD</th>
      <td>-0.215233</td>
    </tr>
    <tr>
      <th>AGO</th>
      <td>-0.232177</td>
    </tr>
    <tr>
      <th>TUR</th>
      <td>-0.285563</td>
    </tr>
  </tbody>
</table>
<p>170 rows × 1 columns</p>
</div></div>
</div>
<p>Seychelles indeed have outsized influence. To a lesser extent, so does Lesotho.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_8h3</span><span class="p">(</span><span class="n">rugged</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">log_gdp</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">plate</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;continent&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">rugged</span> <span class="o">-</span> <span class="n">rugged_bar</span><span class="p">))</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">log_gdp</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;log_gdp&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">log_gdp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log_gdp</span>


<span class="n">guide_8h3</span> <span class="o">=</span> <span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">model_8h3</span><span class="p">)</span>
<span class="n">svi_8h3</span> <span class="o">=</span> <span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8h3</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide_8h3</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">posterior_samples_8h3</span> <span class="o">=</span> <span class="n">guide_8h3</span><span class="o">.</span><span class="n">sample_posterior</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span>
    <span class="n">svi_8h3</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
    <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,),</span>
<span class="p">)</span>
<span class="n">log_likelihood_8h3</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">infer</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8h3</span><span class="p">,</span>
    <span class="n">posterior_samples</span><span class="o">=</span><span class="n">posterior_samples_8h3</span><span class="p">,</span>
    <span class="n">rugged</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;rugged_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_gdp</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_gdp_std&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">idata_8h3</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="n">posterior</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">posterior_samples_8h3</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">log_likelihood</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">log_likelihood_8h3</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██| 2000/2000 [00:01&lt;00:00, 1568.78it/s, init loss: 352.2472, avg. loss [1901-2000]: -115.6799]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span>
    <span class="n">prune_return_sites</span><span class="p">(</span><span class="n">posterior_samples_8h3</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]),</span>
    <span class="n">group_by_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">az</span><span class="o">.</span><span class="n">loo</span><span class="p">(</span><span class="n">idata_8h3</span><span class="p">,</span> <span class="n">pointwise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;deviance&quot;</span><span class="p">)[</span><span class="s2">&quot;pareto_k&quot;</span><span class="p">],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;isocode&quot;</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pareto_k&quot;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;pareto_k&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                mean       std    median      5.0%     95.0%     n_eff     r_hat
      a[0]      0.86      0.02      0.86      0.83      0.89   1035.36      1.00
      a[1]      1.05      0.01      1.05      1.03      1.06   1034.48      1.00
      b[0]      0.12      0.08      0.12      0.00      0.25    842.42      1.00
      b[1]     -0.21      0.06     -0.21     -0.33     -0.12    932.10      1.00
     sigma      0.09      0.01      0.09      0.07      0.10    981.17      1.00

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pareto_k</th>
    </tr>
    <tr>
      <th>isocode</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LSO</th>
      <td>0.296777</td>
    </tr>
    <tr>
      <th>DJI</th>
      <td>0.222500</td>
    </tr>
    <tr>
      <th>ALB</th>
      <td>0.222326</td>
    </tr>
    <tr>
      <th>NPL</th>
      <td>0.202210</td>
    </tr>
    <tr>
      <th>SWZ</th>
      <td>0.198636</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>GBR</th>
      <td>-0.127396</td>
    </tr>
    <tr>
      <th>IRL</th>
      <td>-0.135216</td>
    </tr>
    <tr>
      <th>SLE</th>
      <td>-0.141888</td>
    </tr>
    <tr>
      <th>BWA</th>
      <td>-0.152656</td>
    </tr>
    <tr>
      <th>GAB</th>
      <td>-0.198659</td>
    </tr>
  </tbody>
</table>
<p>170 rows × 1 columns</p>
</div></div>
</div>
<p>No more outsized influence of any one country. Also, the beta coefficient is not much stronger.</p>
</section>
<section id="8H4">
<h3>8H4<a class="headerlink" href="#8H4" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/nettle.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;lang.per.cap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;num.lang&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;k.pop&quot;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_langpc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;lang.per.cap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(74, 10)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country</th>
      <th>num.lang</th>
      <th>area</th>
      <th>k.pop</th>
      <th>num.stations</th>
      <th>mean.growing.season</th>
      <th>sd.growing.season</th>
      <th>lang.per.cap</th>
      <th>log_langpc</th>
      <th>log_area</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Algeria</td>
      <td>18</td>
      <td>2381741</td>
      <td>25660</td>
      <td>102</td>
      <td>6.60</td>
      <td>2.29</td>
      <td>0.000701</td>
      <td>-7.262317</td>
      <td>14.683342</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Angola</td>
      <td>42</td>
      <td>1246700</td>
      <td>10303</td>
      <td>50</td>
      <td>6.22</td>
      <td>1.87</td>
      <td>0.004076</td>
      <td>-5.502521</td>
      <td>14.036011</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Australia</td>
      <td>234</td>
      <td>7713364</td>
      <td>17336</td>
      <td>134</td>
      <td>6.00</td>
      <td>4.17</td>
      <td>0.013498</td>
      <td>-4.305220</td>
      <td>15.858465</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Bangladesh</td>
      <td>37</td>
      <td>143998</td>
      <td>118745</td>
      <td>20</td>
      <td>7.40</td>
      <td>0.73</td>
      <td>0.000312</td>
      <td>-8.073815</td>
      <td>11.877555</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Benin</td>
      <td>52</td>
      <td>112622</td>
      <td>4889</td>
      <td>7</td>
      <td>7.14</td>
      <td>0.99</td>
      <td>0.010636</td>
      <td>-4.543499</td>
      <td>11.631792</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_8h4a</span><span class="p">(</span><span class="n">mean_growing_season</span><span class="p">,</span> <span class="n">log_langpc</span><span class="p">):</span>
    <span class="c1"># Prior: guessing 10 languages spoke in France (populaion = 60M)</span>
    <span class="c1"># log means taking the order of magnitude. 2 order magnitude in SD s/b v vague</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span> <span class="o">/</span> <span class="mi">60_000</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">beta_mean_growing_season</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="s2">&quot;beta_mean_growing_season&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span>
        <span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta_mean_growing_season</span> <span class="o">*</span> <span class="n">mean_growing_season</span>
    <span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">log_langpc</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;log_langpc&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">log_langpc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log_langpc</span>


<span class="n">guide_8h4a</span> <span class="o">=</span> <span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">model_8h4a</span><span class="p">)</span>
<span class="n">svi_8h4a</span> <span class="o">=</span> <span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8h4a</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide_8h4a</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">mean_growing_season</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;mean.growing.season&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_langpc</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_langpc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="n">num_steps</span><span class="o">=</span><span class="mi">2_500</span><span class="p">)</span>
<span class="n">posterior_samples_8h4a</span> <span class="o">=</span> <span class="n">guide_8h4a</span><span class="o">.</span><span class="n">sample_posterior</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">svi_8h4a</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,)</span>
<span class="p">)</span>
<span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span>
    <span class="n">prune_return_sites</span><span class="p">(</span><span class="n">posterior_samples_8h4a</span><span class="p">),</span> <span class="n">group_by_chain</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██| 2500/2500 [00:01&lt;00:00, 1777.14it/s, init loss: 2894.2744, avg. loss [2376-2500]: 135.1775]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                                mean       std    median      5.0%     95.0%     n_eff     r_hat
                     alpha     -6.74      0.40     -6.73     -7.46     -6.14    935.40      1.00
  beta_mean_growing_season      0.18      0.05      0.18      0.09      0.26    948.72      1.00
                     sigma      1.41      0.11      1.40      1.22      1.59   1140.77      1.00

</pre></div></div>
</div>
<p>Good evidence that the longer the mean growing season, the more language diversity</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_8h4b</span><span class="p">(</span><span class="n">sd_growing_season</span><span class="p">,</span> <span class="n">log_langpc</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span> <span class="o">/</span> <span class="mi">60_000</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">beta_sd_growing_season</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;beta_sd_growing_season&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span>
        <span class="s2">&quot;mu&quot;</span><span class="p">,</span>
        <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta_sd_growing_season</span> <span class="o">*</span> <span class="n">sd_growing_season</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">log_langpc</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;log_langpc&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">log_langpc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log_langpc</span>


<span class="n">guide_8h4b</span> <span class="o">=</span> <span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">model_8h4b</span><span class="p">)</span>
<span class="n">svi_8h4b</span> <span class="o">=</span> <span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8h4b</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide_8h4b</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">sd_growing_season</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;sd.growing.season&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_langpc</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_langpc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="n">num_steps</span><span class="o">=</span><span class="mi">2_500</span><span class="p">)</span>
<span class="n">posterior_samples_8h4b</span> <span class="o">=</span> <span class="n">guide_8h4b</span><span class="o">.</span><span class="n">sample_posterior</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">svi_8h4b</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,)</span>
<span class="p">)</span>
<span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span>
    <span class="n">prune_return_sites</span><span class="p">(</span><span class="n">posterior_samples_8h4b</span><span class="p">),</span> <span class="n">group_by_chain</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|███| 2500/2500 [00:01&lt;00:00, 1520.95it/s, init loss: 232.3436, avg. loss [2376-2500]: 139.1950]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                              mean       std    median      5.0%     95.0%     n_eff     r_hat
                   alpha     -4.93      0.32     -4.92     -5.50     -4.44    935.40      1.00
  beta_sd_growing_season     -0.32      0.16     -0.32     -0.59     -0.08    953.37      1.00
                   sigma      1.46      0.12      1.46      1.27      1.64   1140.65      1.00

</pre></div></div>
</div>
<p>Good evidence that the larger the uncertainty around the growing season, the less language diversity</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model_8h4c</span><span class="p">(</span><span class="n">mean_growing_season</span><span class="p">,</span> <span class="n">sd_growing_season</span><span class="p">,</span> <span class="n">log_langpc</span><span class="p">):</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span> <span class="o">/</span> <span class="mi">60_000</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">beta_mean_growing_season</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="s2">&quot;beta_mean_growing_season&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">beta_sd_growing_season</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="s2">&quot;beta_sd_growing_season&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">beta_mean_sd_growing_season</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="s2">&quot;beta_mean_sd_growing_season&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">deterministic</span><span class="p">(</span>
        <span class="s2">&quot;mu&quot;</span><span class="p">,</span>
        <span class="n">alpha</span>
        <span class="o">+</span> <span class="n">beta_mean_growing_season</span> <span class="o">*</span> <span class="n">mean_growing_season</span>
        <span class="o">+</span> <span class="n">beta_sd_growing_season</span> <span class="o">*</span> <span class="n">sd_growing_season</span>
        <span class="o">+</span> <span class="n">beta_mean_sd_growing_season</span> <span class="o">*</span> <span class="n">mean_growing_season</span> <span class="o">*</span> <span class="n">sd_growing_season</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">log_langpc</span> <span class="o">=</span> <span class="n">numpyro</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="s2">&quot;log_langpc&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">),</span> <span class="n">obs</span><span class="o">=</span><span class="n">log_langpc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">log_langpc</span>


<span class="n">guide_8h4c</span> <span class="o">=</span> <span class="n">AutoLaplaceApproximation</span><span class="p">(</span><span class="n">model_8h4c</span><span class="p">)</span>
<span class="n">svi_8h4c</span> <span class="o">=</span> <span class="n">SVI</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_8h4c</span><span class="p">,</span>
    <span class="n">guide</span><span class="o">=</span><span class="n">guide_8h4c</span><span class="p">,</span>
    <span class="n">optim</span><span class="o">=</span><span class="n">optim</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">mean_growing_season</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;mean.growing.season&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">sd_growing_season</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;sd.growing.season&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">log_langpc</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;log_langpc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">jrng</span><span class="p">,</span> <span class="n">num_steps</span><span class="o">=</span><span class="mi">2_500</span><span class="p">)</span>
<span class="n">posterior_samples_8h4c</span> <span class="o">=</span> <span class="n">guide_8h4c</span><span class="o">.</span><span class="n">sample_posterior</span><span class="p">(</span>
    <span class="n">jrng</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">svi_8h4c</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">sample_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,)</span>
<span class="p">)</span>
<span class="n">numpyro</span><span class="o">.</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span>
    <span class="n">prune_return_sites</span><span class="p">(</span><span class="n">posterior_samples_8h4c</span><span class="p">),</span> <span class="n">group_by_chain</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██| 2500/2500 [00:01&lt;00:00, 1329.87it/s, init loss: 3651.1829, avg. loss [2376-2500]: 137.4539]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

                                   mean       std    median      5.0%     95.0%     n_eff     r_hat
                        alpha     -7.11      0.58     -7.10     -8.16     -6.29   1035.36      1.00
     beta_mean_growing_season      0.31      0.07      0.31      0.20      0.43   1087.97      1.00
  beta_mean_sd_growing_season     -0.12      0.05     -0.12     -0.19     -0.04    987.62      1.00
       beta_sd_growing_season      0.50      0.36      0.50     -0.08      1.10    915.64      1.00
                        sigma      1.31      0.11      1.31      1.13      1.49   1033.41      1.00

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

          <div class="sidebar-resize-handle"></div>

<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="02_small_and_large_worlds.html">Chapter 2: Small Worlds And Large Worlds</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_sampling_the_imaginary.html">Chapter 3: Sampling the Imaginary</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_geocentric_models.html">Chapter 4: Geocentric Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_the_many_variables_and_the_spurious_waffles.html">Chapter 5: The Many Variables And The Spurious Waffles</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_the_haunted_dag_and_the_causal_terror.html">Chapter 6: The Haunted DAG &amp; The Causal Terror</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_ulysse_s_copmpass.html">Chapter 7: Ulysse’s Compass</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Chapter 8: Conditional Manatees</a></li>
</ul>

<div><hr class="docutils"></div>
<ul>
  <li class="toctree-l1"><a class="reference internal" href="../genindex.html" accesskey="I">General Index</a></li>
</ul>
<div id="ethical-ad-placement"></div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <nav class="relbar">
      <a class="previous" href="07_ulysse_s_copmpass.html" aria-label="Previous topic" >
        <div class="icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"/></svg>
        </div>
        <div class="title">
          <span class="text">
            <span class="direction">previous</span>
            Chapter 7: Ulysse’s Compass
          </span>
        </div>
      </a>
    </nav>

    <footer role="contentinfo">
      &#169; Copyright 2022, Ludovic Tiako.
      Created using <a class="reference external" href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
      <a class="reference external" href="https://insipid-sphinx-theme.readthedocs.io/">Insipid Theme</a>.
    </footer>
  </body>
</html>